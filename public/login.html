<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description"
    content="Faça login na plataforma EduScore para acessar sua conta e gerenciar seus alunos e simulados." />
  <title>Login - EduScore</title>
  <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:ital,wght@0,400;0,700;1,400&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <script src="utils.js" defer></script>
</head>

<body>
  <!-- Skip Links para navegação por teclado -->
  <a href="#main-content" class="skip-link">Pular para conteúdo principal</a>

  <!-- Header -->
  <header class="landing-header" role="banner">
    <div class="landing-header-container">
      <div class="landing-logo">
        <span class="landing-logo-text">EduScore</span>
      </div>
      <nav class="landing-nav" role="navigation" aria-label="Navegação principal">
        <a href="landing.html" class="landing-nav-link">Voltar</a>
        <a href="perfil.html" class="landing-nav-link landing-nav-link-primary">Cadastrar-se</a>
      </nav>
    </div>
  </header>

  <!-- Login Section -->
  <section id="main-content" class="features-section" role="main"
    style="min-height: calc(100vh - 200px); display: flex; align-items: center; padding: var(--spacing-4xl) 0;">
    <div class="section-container">
      <!-- Logo e Título -->
      <div style="text-align: center; margin-bottom: var(--spacing-3xl);">
        <h1 class="section-title" style="font-size: var(--font-size-3xl); margin-bottom: var(--spacing-sm);">Faça seu
          login</h1>
        <p class="section-subtitle" style="font-size: var(--font-size-base); margin-bottom: 0;">
          É necessário seu <strong>email institucional</strong>
        </p>
      </div>

      <!-- Container lado a lado: Formulário + Citação -->
      <div class="login-layout-container"
        style="display: grid; grid-template-columns: 1fr 1.3fr; gap: var(--spacing-3xl); align-items: stretch; max-width: 1200px; margin: 0 auto;">
        <!-- Formulário de Login -->
        <div class="card" style="padding: var(--spacing-3xl); display: flex; flex-direction: column; height: 100%;">
          <form id="loginForm" onsubmit="handleLogin(event)"
            style="display: flex; flex-direction: column; gap: var(--spacing-lg); flex: 1;">
            <div class="input-group">
              <label for="email">Email institucional</label>
              <input type="email" id="email" name="email" placeholder="exemplo@instituicao.edu.br" required
                autocomplete="email"
                style="width: 100%; padding: var(--spacing-md); border: 1px solid var(--color-border); border-radius: var(--radius-sm); font-size: var(--font-size-base); outline: none; transition: border-color var(--transition-base);" />
              <span class="input-hint">Use seu email institucional cadastrado</span>
            </div>

            <div class="input-group">
              <label for="senha">Senha</label>
              <input type="password" id="senha" name="senha" placeholder="Digite sua senha" required
                autocomplete="current-password"
                style="width: 100%; padding: var(--spacing-md); border: 1px solid var(--color-border); border-radius: var(--radius-sm); font-size: var(--font-size-base); outline: none; transition: border-color var(--transition-base);" />
            </div>

            <button type="submit" class="btn-primary" style="width: 100%; margin-top: var(--spacing-md);">
              <span id="loginBtnText">Continuar com email</span>
              <span id="loginSpinner" class="loading-spinner" style="display: none;"></span>
            </button>
          </form>

          <!-- Links -->
          <div
            style="margin-top: var(--spacing-xl); text-align: center; padding-top: var(--spacing-lg); border-top: 1px solid var(--color-border-light);">
            <a href="perfil.html"
              style="color: var(--color-primary); text-decoration: none; font-size: var(--font-size-sm); margin-right: var(--spacing-md);">Cadastre-se</a>
            <span style="color: var(--color-text-lighter); margin: 0 var(--spacing-sm);">|</span>
            <a href="redefinir.html"
              style="color: var(--color-primary); text-decoration: none; font-size: var(--font-size-sm);">Esqueceu a
              senha?</a>
          </div>
        </div>

        <!-- Quote Card -->
        <div class="card"
          style="padding: var(--spacing-3xl); background: linear-gradient(135deg, var(--color-primary-darker) 0%, var(--color-primary) 100%); color: var(--color-surface); display: flex; flex-direction: column; justify-content: center; height: 100%;">
          <div
            style="font-size: var(--font-size-2xl); line-height: var(--line-height-relaxed); margin-bottom: var(--spacing-lg); font-weight: 500;">
            "Educar não é ensinar respostas, é ensinar a pensar."
          </div>
          <div style="font-size: var(--font-size-base); opacity: 0.95; font-weight: 500;">
            Jean Piaget
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="landing-footer" role="contentinfo">
    <div class="section-container">
      <div class="footer-content">
        <div class="footer-brand">
        </div>
        <p class="footer-text">
          Plataforma de gestão pedagógica desenvolvida para equipes educacionais.
        </p>
      </div>
      <div class="footer-bottom">
        <p class="footer-copyright">&copy; 2025 EduScore. Todos os direitos reservados.</p>
      </div>
    </div>
  </footer>

  <script>
    async function handleLogin(event) {
      event.preventDefault();

      const email = document.querySelector('#email').value.trim();
      const senha = document.querySelector('#senha').value;

      // Validação (Heurística 5: Prevenção de erros)
      if (!email || !senha) {
        showToast('Por favor, preencha todos os campos', 'warning');
        return;
      }

      if (!isValidEmail(email)) {
        showToast('Email inválido. Use um email institucional válido', 'error');
        return;
      }

      // Feedback visual (Heurística 1: Visibilidade do status)
      const btnText = document.getElementById('loginBtnText');
      const spinner = document.getElementById('loginSpinner');
      const submitBtn = event.target.querySelector('button[type="submit"]');

      btnText.style.display = 'none';
      spinner.style.display = 'inline-block';
      submitBtn.disabled = true;

      try {
        const response = await apiFetch('/api/usuarios/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ email, senha })
        });

        const data = await response.json();

        if (data.sucesso) {
          showToast('Login realizado com sucesso! Redirecionando...', 'success');
          localStorage.setItem('token', data.token);

          setTimeout(() => {
            window.location.href = '/home.html';
          }, 1000);
        } else {
          showToast('Erro: ' + data.erro, 'error', 5000);
          btnText.style.display = 'inline';
          spinner.style.display = 'none';
          submitBtn.disabled = false;
        }
      } catch (error) {
        showToast('Erro de conexão. Verifique sua internet.', 'error', 5000);
        btnText.style.display = 'inline';
        spinner.style.display = 'none';
        submitBtn.disabled = false;
      }
    }
  </script>
</body>

</html>